- name: Install python-apt
  apt:
    name: python-apt
    state: present

- name: Install aptitude
  apt:
    name: aptitude
    state: present

- name: Install unattended-upgrades
  apt:
    name: unattended-upgrades
    state: present

- name: Configure periodic unattended-upgrades
  copy:
    src: files/02periodic
    dest: /etc/apt/apt.conf.d/02periodic
    owner: root
    group: root
    mode: 0644

- name: Enable sshd on start
  file:
    path: /etc/ssh/sshd_not_to_be_run
    state: absent

- name: Create ssh directory
  file:
    path: /home/{{ lookup('env','USER') }}/.ssh
    state: directory
    owner: "{{ lookup('env','USER') }}"
    group: "{{ lookup('env','USER') }}"
    mode: '0700'

- name: Create ssh directory
  file:
    path: /home/{{ lookup('env','USER') }}/.ssh
    state: directory
    owner: "{{ lookup('env','USER') }}"
    group: "{{ lookup('env','USER') }}"
    mode: '0700'

- name: Setup SSH authorization_keys file
  copy:
    src: files/authorized_keys
    dest: /home/{{ lookup('env','USER') }}/.ssh/authorized_keys
    owner: "{{ lookup('env','USER') }}"
    group: "{{ lookup('env','USER') }}"
    mode: '0600'
