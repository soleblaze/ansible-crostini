- name: Install python-apt
  apt:
    name: python-apt
    state: present

- name: Install aptitude
  apt:
    name: aptitude
    state: present

- name: Install unattended-upgrades
  apt:
    name: unattended-upgrades
    state: present

- name: Configure periodic unattended-upgrades
  copy:
    src: files/02periodic
    dest: /etc/apt/apt.conf.d/02periodic
    owner: root
    group: root
    mode: 0644

# This doesn't currently appear to work correctly, but I'm keeping it here
# in case that changes in the future
- name: Configure sommelier
  copy:
    src: files/sommelierrc
    dest: /home/{{ lookup('env','USER') }}/.sommelierrc
    owner: "{{ lookup('env','USER') }}"
    group: "{{ lookup('env','USER') }}"
    mode: '0600'

- name: Create cros-garcon systemd config directory
  file:
    path: /home/{{ lookup('env','USER') }}/.config/systemd/user/cros-garcon.service.d
    owner: "{{ lookup('env','USER') }}"
    group: "{{ lookup('env','USER') }}"
    mode: '0750'
    state: directory

- name: Configure cros-garcon via systemd
  copy:
    src: files/cros-garcon-override.conf
    dest: /home/{{ lookup('env','USER') }}/.config/systemd/user/cros-garcon.service.d/cros-garcon-override.conf
    owner: "{{ lookup('env','USER') }}"
    group: "{{ lookup('env','USER') }}"
    mode: '0640'
